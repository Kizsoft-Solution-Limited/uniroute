# Tunnel server - publish main port and TCP/UDP tunnel port range for TCP/TLS/UDP tunnels.
# Use this with Coolify or: docker-compose -f docker-compose.tunnel.yml up -d
services:
  tunnel:
    build:
      context: .
      dockerfile: Dockerfile.tunnel
    ports:
      - "8081:8080"   # Main WebSocket/HTTP (map host 8081 -> container 8080, or set PORT=8081 in env)
      - "20000-20100:20000-20100"     # TCP tunnel ports (Docker default is TCP only)
      - "20000-20100:20000-20100/udp" # UDP tunnel ports (required for uniroute udp)
    environment:
      - PORT=8080
      - TUNNEL_TCP_PORT_RANGE=101
      # Optional: TUNNEL_TCP_PORT_BASE=20000 (default)
      # Set TUNNEL_BASE_DOMAIN, DATABASE_URL, JWT_SECRET, etc. as needed
    restart: unless-stopped
